<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NDIS Support Portal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css"> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" xintegrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <script type="module">
    // This firebaseConfig will be used by script.js
    // It's populated with values from your Firebase project.
    // If __firebase_config is provided by the Canvas environment, it will override this.
    window.firebaseConfigForApp = {
        apiKey: "AIzaSyA33RDvrpWXUeOZYBpfJaqrytbUQFo0cgs", // User's provided API key
        authDomain: "ndis-portal-6ab1e.firebaseapp.com",
        databaseURL: "https://ndis-portal-6ab1e-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "ndis-portal-6ab1e",
        storageBucket: "ndis-portal-6ab1e.appspot.com", 
        messagingSenderId: "663606000491",
        appId: "1:663606000491:web:350030eeae4212b899aa2e" // Ensure no trailing space if copied
    };

    // Prioritize __firebase_config if available
    if (typeof __firebase_config !== 'undefined' && __firebase_config) {
        try {
            const parsedConfig = JSON.parse(__firebase_config);
            // Ensure all necessary keys are present in parsedConfig
            if (parsedConfig && 
                parsedConfig.apiKey && !parsedConfig.apiKey.startsWith("YOUR_") &&
                parsedConfig.authDomain &&
                parsedConfig.databaseURL && // Check if databaseURL is needed for Firestore v9+ (usually not for client)
                parsedConfig.projectId &&
                parsedConfig.storageBucket &&
                parsedConfig.messagingSenderId &&
                parsedConfig.appId && !parsedConfig.appId.startsWith("YOUR_")) {
                 window.firebaseConfigForApp = parsedConfig;
                 console.log("Using Firebase config from __firebase_config environment variable.");
            } else {
                console.warn("__firebase_config is incomplete, uses placeholders, or is missing essential keys. Falling back to manually set config in index.html. Ensure __firebase_config provides all required Firebase settings.");
            }
        } catch (e) {
            console.error("Error parsing __firebase_config:", e, "Using manually set config in index.html.");
        }
    }
  </script>

</head>
<body>

<div id="authScreen">
  <div class="dlg"> 
      <h3><i class="fas fa-user-lock"></i> NDIS Portal Access</h3>
      <p style="text-align: center; margin-bottom: 20px; font-size: 0.9rem; color: var(--sec-dark);">Please sign in or register to continue.</p>
      <div class="form-group">
        <label for="authEmail">Email</label> 
        <input type="email" id="authEmail" placeholder="email@example.com" />
      </div>
      <div class="form-group">
        <label for="authPassword">Password</label> 
        <input type="password" id="authPassword" placeholder="••••••••" />
      </div>
      <div class="form-actions" style="justify-content: space-between;">
        <button class="btn-primary" onclick="modalLogin()" style="flex-grow: 1;">Login</button>
        <button class="btn-secondary" onclick="modalRegister()" style="flex-grow: 1;">Register</button>
      </div>
      <div id="authStatusMessage" style="margin-top: 15px; text-align: center; color: var(--danger); font-size: 0.9rem;"></div>
    </div>
</div>

<div id="portalApp">
    <nav id="side">
      <h1 id="portalTitleDisplay"><i class="fas fa-cogs"></i> NDIS Portal</h1>
      <a href="#home"     class="link active"><i class="fas fa-home"></i> Home</a>
      <a href="#profile"  class="link hide"><i class="fas fa-user-circle"></i> Profile</a>
      <a href="#invoice"  class="link hide"><i class="fas fa-file-invoice-dollar"></i> Invoice</a>
      <a href="#agreement"class="link hide"><i class="fas fa-file-signature"></i> Agreement</a>
      <a href="#admin"    class="link hide" id="adminTab"><i class="fas fa-user-shield"></i> Admin</a>
      <button id="logoutBtn" class="btn-secondary btn-small hide" style="margin-top: auto;"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </nav>

    <nav id="bottom">
      <a href="#home"    class="bLink active" aria-label="Home"><i class="fas fa-home"></i></a>
      <a href="#profile" class="bLink hide" aria-label="Profile"><i class="fas fa-user-circle"></i></a>
      <a href="#invoice" class="bLink hide" aria-label="Invoice"><i class="fas fa-file-invoice-dollar"></i></a>
      <a href="#agreement" class="bLink hide" aria-label="Agreement"><i class="fas fa-file-signature"></i></a>
      </nav>

    <main>
      <div id="loadingOverlay" class="modal" style="display: none; background-color: rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index: 2000;">
          <div style="color:white; font-size: 1.5rem; text-align:center;">
              <i class="fas fa-spinner fa-spin fa-2x"></i>
              <p>Loading...</p>
          </div>
      </div>

      <section id="home" class="card active">
        <h2><i class="fas fa-door-open"></i> Welcome</h2>
        <div id="authStatus" style="margin-bottom: 15px; font-style: italic;">
            User ID: <span id="userIdDisplay">Not Logged In</span>
        </div>

        <div id="homeUser" class="hide"> 
          <p class="welcome-message">Welcome back, <span id="userNameDisplay">User</span>!</p>
          <div class="home-buttons-container">
                <button id="rqBtn" class="btn-primary btn-large"><i class="fas fa-calendar-plus"></i> Request a Shift</button>
                <button id="logTodayShiftBtn" class="btn-primary btn-large"><i class="fas fa-clipboard-list"></i> Log New Shift</button>
          </div>
          
          <div id="shiftRequestsContainer" class="hide card-subsection" style="margin-top: 20px;">
            <h3><i class="fas fa-tasks"></i> Shift Requests</h3>
            <div class="table-responsive">
              <table id="rqTbl"><thead>
                <tr><th>Date</th><th>Start</th><th>End</th><th>Reason</th><th>Status</th></tr></thead><tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="profile" class="card">
        <h2><i class="fas fa-id-card"></i> Your Profile</h2>
        <div id="profileDetails" class="card-subsection">
          <p><strong><i class="fas fa-user-tag"></i> Name:</strong> <span id="profileName"></span></p>
          <p><strong><i class="fas fa-briefcase"></i> ABN:</strong> <span id="profileAbn"></span></p>
          <p><strong><i class="fas fa-percent"></i> GST Registered:</strong> <span id="profileGst"></span></p>
          <p><strong><i class="fas fa-landmark"></i> BSB:</strong> <span id="profileBsb"></span></p>
          <p><strong><i class="fas fa-credit-card"></i> Account Number:</strong> <span id="profileAcc"></span></p>
        </div>
        <button onclick="editProfile()" class="btn-secondary"><i class="fas fa-edit"></i> Edit Profile Details</button>
        <hr>
        <div class="card-subsection">
            <h3><i class="fas fa-folder-open"></i> Supporting Documents</h3>
            <div id="profileFilesDisplay">
                <p><strong>Uploaded Files:</strong></p>
                <ul id="profileFilesList"><li>None uploaded.</li></ul>
            </div>
            <div class="form-group">
                <label for="profileFileUpload"><i class="fas fa-file-upload"></i> Upload New Document(s):</label>
                <input type="file" id="profileFileUpload" multiple>
            </div>
            <button onclick="uploadProfileDocuments()" class="btn-secondary"><i class="fas fa-plus-circle"></i> Add Document(s) to Profile</button>
        </div>
      </section>

      <section id="invoice" class="card">
        <div id="setInitialInvoiceModal" class="modal"> <div class="dlg">
                <h3><i class="fas fa-file-invoice"></i> Set Starting Invoice Number</h3>
                <p>Please set your starting invoice number. This will auto-increment for future invoices.</p>
                <div class="form-group">
                    <label for="initialInvoiceNumberInput">Starting Invoice Number:</label>
                    <input type="number" id="initialInvoiceNumberInput" placeholder="e.g., 1001">
                </div>
                <div class="modal-actions">
                    <button onclick="saveInitialInvoiceNumber()" class="btn-primary"><i class="fas fa-save"></i> Save and Continue</button>
                </div>
            </div>
        </div>
        <h2><i class="fas fa-calculator"></i> Invoice – Week <span id="wkLbl"></span></h2>

        <div id="invoicePdfContent"> <div class="row">
              <div class="form-group">
                <label for="invNo">Invoice #</label>
                <input id="invNo" readonly>
              </div>
              <div class="form-group"><label for="invDate">Date issued</label><input type="date" id="invDate"></div>
            </div>

            <div class="row" id="providerDetailsRow">
              <div class="form-group"><label for="provName">Provider (your name)</label><input id="provName" readonly></div>
              <div class="form-group"><label for="provAbn">ABN</label><input id="provAbn" readonly></div>
              <div id="gstFlagContainer" class="form-group"><label for="gstFlag">GST Registered</label><input id="gstFlag" readonly></div>
            </div>
            <div class="table-responsive">
              <table id="invTbl"><thead>
                <tr>
                    <th>#</th>
                    <th>Date</th>
                    <th class="column-code print-only pdf-show">Code</th> 
                    <th>Description</th>
                    <th>Start</th>
                    <th>End</th>
                    <th class="column-rate-type print-only pdf-show">Rate type</th> 
                    <th class="print-only-column pdf-show">Rate/Unit ($)</th> 
                    <th>Hours / Km</th> 
                    <th class="no-print pdf-hide">Travel Input (Km)</th> <th class="no-print pdf-hide">Claim Travel</th> 
                    <th>Total ($)</th>
                    <th class="no-print pdf-hide">Actions</th>
                </tr>
              </thead><tbody></tbody></table>
            </div>
            <div class="totals">
              <div>Subtotal:  <b id="sub">$0.00</b></div>
              <div id="gstRow" style="display:none">GST 10 %:  <b id="gst">$0.00</b></div>
              <div>Total:  <b id="grand">$0.00</b></div>
            </div>
        </div> 
        <div class="invoice-actions">
            <button onclick="addInvRowUserAction()" class="btn-primary"><i class="fas fa-plus"></i> Add Service Manually</button> 
            <button class="btn-secondary" onclick="saveDraft()"><i class="fas fa-save"></i> Save Draft</button>
            <button class="btn-secondary" onclick="generateInvoicePdf()"><i class="fas fa-file-pdf"></i> Download PDF</button> 
        </div>
      </section>

      <section id="agreement" class="card">
        <h2 id="agreementDynamicTitle"><i class="fas fa-handshake"></i> Service Agreement</h2> 

        <div id="adminAgreementWorkerSelector" class="form-group card-subsection hide" style="margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: var(--radius); background-color: var(--sec-light);">
            <h4><i class="fas fa-user-cog"></i> Admin: View Agreement for Specific Worker</h4>
            <label for="adminSelectWorkerForAgreement">Select Support Worker:</label>
            <select id="adminSelectWorkerForAgreement" class="invoice-input-condensed">
                <option value="">-- Select a Worker --</option>
            </select>
            <button onclick="loadServiceAgreementForSelectedWorker()" class="btn-secondary btn-small" style="margin-top:10px;"><i class="fas fa-eye"></i> Load Agreement</button>
            <p class="tip">Participant details are taken from Global Settings. Worker details and authorized services are from the selected worker's profile.</p>
        </div>

        <div id="agrChip" class="chip yellow">Draft – waiting for signatures</div>

        <div id="agreementContentWrapper"> 
            <div id="agreementHeaderForPdf" style="display:none; text-align:center; margin-bottom:20px;">
                </div>
            <div id="agreementContentContainer" class="agreement-content">
                </div>
            <hr>
            <div class="signWrap">
              <div><b>Participant</b><br><img id="sigP" alt="Participant Signature Area" class="signature-image"><br>Date <span id="dP">___</span></div>
              <div><b>Support Worker</b><br><img id="sigW" alt="Support Worker Signature Area" class="signature-image"><br>Date <span id="dW">___</span></div>
            </div>
        </div>
        <div class="agreement-actions">
            <button id="signBtn" class="btn-primary"><i class="fas fa-signature"></i> Sign agreement</button>
            <button id="participantSignBtn" class="btn-primary hide"><i class="fas fa-user-edit"></i> Sign for Participant</button> 
            <button id="pdfBtn" class="btn-secondary hide"><i class="fas fa-file-pdf"></i> Download PDF</button>
        </div>
      </section>

      <section id="admin" class="card">
        <h2><i class="fas fa-tools"></i> Admin Dashboard</h2>
        <div class="admin-nav-tabs">
            <button class="admin-tab-btn active" data-target="adminGlobalSettings"><i class="fas fa-globe-americas"></i> Global Settings</button>
            <button class="admin-tab-btn" data-target="adminServiceManagement"><i class="fas fa-concierge-bell"></i> NDIS Services</button>
            <button class="admin-tab-btn" data-target="adminAgreementCustomization"><i class="fas fa-file-alt"></i> Agreement Template</button>
            <button class="admin-tab-btn" data-target="adminWorkerManagement"><i class="fas fa-users-cog"></i> Worker Management</button>
        </div>

        <div id="adminGlobalSettings" class="admin-content-panel active card-subsection">
            <h3><i class="fas fa-cogs"></i> Portal Global Settings</h3>
            <p>These settings affect the entire portal, including defaults for service agreements and invoices.</p>
            <div id="editPortalSettingsContainer">
                <div id="adminEditOrgDetailsSection" class="form-section">
                    <h4><i class="fas fa-building"></i> Organization Details</h4>
                    <div class="form-group"><label for="adminEditOrgName">Organization/Provider Name:</label><input id="adminEditOrgName" type="text"></div>
                    <div class="form-group"><label for="adminEditOrgAbn">Organization ABN:</label><input id="adminEditOrgAbn" type="text"></div>
                    <div class="form-group"><label for="adminEditOrgContactEmail">Primary Contact Email:</label><input id="adminEditOrgContactEmail" type="email"></div>
                    <div class="form-group"><label for="adminEditOrgContactPhone">Primary Contact Phone:</label><input id="adminEditOrgContactPhone" type="text"></div>
                </div>
                <hr id="adminEditParticipantHr" /> 
                <div id="adminEditParticipantDetailsSection" class="form-section">
                    <h4 id="adminEditParticipantTitle"><i class="fas fa-child"></i> Default Participant & Plan Details</h4>
                    <div class="form-group"><label for="adminEditParticipantName">Participant's Full Name:</label><input id="adminEditParticipantName" type="text"></div>
                    <div class="form-group"><label for="adminEditParticipantNdisNo">Participant's NDIS Number:</label><input id="adminEditParticipantNdisNo" type="text"></div>
                    <div class="form-group"><label for="adminEditPlanManagerName">Plan Manager Name:</label><input id="adminEditPlanManagerName" type="text"></div>
                    <div class="form-group"><label for="adminEditPlanManagerEmail">Plan Manager Email:</label><input id="adminEditPlanManagerEmail" type="email"></div>
                    <div class="form-group"><label for="adminEditPlanManagerPhone">Plan Manager Phone:</label><input id="adminEditPlanManagerPhone" type="text"></div>
                    <div class="form-group"><label for="adminEditPlanEndDate">Current Plan End Date:</label><input id="adminEditPlanEndDate" type="date"></div>
                </div>
                <div class="form-actions" style="margin-top:20px;">
                    <button onclick="saveAdminPortalSettings()" class="btn-primary"><i class="fas fa-save"></i> Save All Portal Settings</button>
                    <button class="btn-danger" onclick="resetGlobalSettingsToDefaults()" title="Resets all portal settings to their original defaults."><i class="fas fa-undo"></i> Reset Portal to Defaults</button>
                </div>
            </div>
             <hr>
            <p>Invite link for new support workers:</p>
            <div class="invite-link-container">
              <code id="invite"></code>
              <button class="btn-secondary btn-small" onclick="copyLink()"><i class="fas fa-copy"></i> Copy Link</button>
            </div>
        </div>

        <div id="adminServiceManagement" class="admin-content-panel card-subsection">
            <h3><i class="fas fa-list-alt"></i> Manage NDIS Support Services</h3>
            <p>Define NDIS support services. All services defined here are globally available for worker authorization via "Worker Management".</p>
            <div id="adminServiceFormContainer" class="form-section">
                <h4><i class="fas fa-plus-square"></i> Add/Edit Service</h4>
                <input type="hidden" id="adminServiceId"> 
                
                <div class="form-group">
                    <label for="adminServiceCode">NDIS Item Code:</label>
                    <input type="text" id="adminServiceCode" placeholder="e.g., 01_011_0107_1_1">
                </div>

                <div class="form-group">
                    <label for="adminServiceDescription">Description:</label>
                    <input type="text" id="adminServiceDescription" placeholder="e.g., Assistance with Daily Life">
                </div>

                <div class="form-group">
                    <label for="adminServiceCategoryType">Service Category Type:</label>
                    <select id="adminServiceCategoryType">
                        <option value="core_standard">Core - Standard (Weekday/Evening/Night/Weekend/PH Rates)</option>
                        <option value="core_high_intensity">Core - High Intensity (Weekday/Evening/Night/Weekend/PH Rates)</option>
                        <option value="capacity_therapy_std">Capacity Building - Therapy Standard Rate</option>
                        <option value="capacity_specialist">Capacity Building - Specialist Rate (e.g., Specialist Behaviour Support)</option>
                        <option value="travel_km">Travel - Per Kilometre</option>
                        <option value="other_flat_rate">Other - Single Flat Rate (e.g. Consumables)</option>
                    </select>
                </div>
                
                <div id="adminServiceRateFieldsContainer">
                    </div>

                <div class="form-group">
                    <label for="adminServiceTravelCodeDisplay">Associated Travel Item Code (for this service):</label>
                    <div class="travel-code-selection-container">
                        <input type="text" id="adminServiceTravelCodeDisplay" readonly placeholder="None selected">
                        <button id="selectTravelCodeBtn" class="btn-secondary btn-small"><i class="fas fa-route"></i> Select/Change</button>
                    </div>
                    <input type="hidden" id="adminServiceTravelCode">
                    <p class="tip">If this service can have travel claimed for it, select an existing NDIS Travel Item Code defined elsewhere in this list. The travel item should have its per-KM rate set (usually as its Weekday Rate).</p>
                </div>

                <div class="form-actions">
                    <button onclick="saveAdminService()" class="btn-primary"><i class="fas fa-save"></i> Save Service</button>
                    <button class="btn-secondary" onclick="clearAdminServiceForm()"><i class="fas fa-eraser"></i> Clear Form</button>
                </div>
            </div>
            <hr>
            <h4><i class="fas fa-stream"></i> Current Services</h4>
            <div class="table-responsive">
                <table id="adminServicesTable">
                    <thead>
                        <tr>
                            <th>Item Code</th>
                            <th>Description</th>
                            <th>Category Type</th>
                            <th>Primary Rate</th>
                            <th>Travel Code</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="adminAgreementCustomization" class="admin-content-panel card-subsection">
            <h3><i class="fas fa-edit"></i> Service Agreement Customization</h3>
            <p>Structure your service agreement by adding and editing clauses. Use placeholders like <code>{{participantName}}</code>, <code>{{workerName}}</code>, <code>{{serviceList}}</code>, etc., within clause bodies. The <code>{{serviceList}}</code> placeholder will be replaced with the worker's authorized services.</p>
            
            <div class="form-group">
                <label for="adminAgreementOverallTitle">Overall Agreement Title:</label>
                <input type="text" id="adminAgreementOverallTitle" placeholder="e.g., NDIS Service Agreement">
            </div>

            <div id="adminAgreementClausesContainer">
                </div>

            <div class="form-actions" style="margin-top: 15px;">
                <button id="adminAddAgreementClauseBtn" class="btn-secondary"><i class="fas fa-plus-circle"></i> Add New Clause</button>
                <button onclick="saveAdminAgreementCustomizations()" class="btn-primary"><i class="fas fa-save"></i> Save Agreement Structure</button>
            </div>
            <hr>
            <h4><i class="fas fa-eye"></i> Example Agreement Preview:</h4>
            <div id="adminAgreementPreview" class="agreement-preview-box">
                <p><em>Save changes to see an updated preview. Placeholders will not be filled here.</em></p>
            </div>
        </div>
        
        <div id="adminWorkerManagement" class="admin-content-panel card-subsection">
          <h3><i class="fas fa-id-badge"></i> Worker Management</h3>
          <p>Manage support worker approvals and the NDIS services they are authorized to provide. Services must first be defined in the "NDIS Services" tab.</p>
          
          <div class="card-subsection" style="margin-top: 20px; background-color: var(--warn-light, #fff9e6); border-color: var(--warn, #ffc107); padding:15px; border-radius:var(--radius);">
              <h4><i class="fas fa-user-clock"></i> Workers Awaiting Approval</h4>
              <div id="pendingWorkersListContainer" style="max-height: 300px; overflow-y:auto;">
                  <ul id="pendingWorkersList" class="worker-list-auth" style="list-style-type: none; padding:0;">
                      <li>Loading pending workers...</li>
                  </ul>
              </div>
              <p class="tip" id="noPendingWorkersMessage" style="display:none;">There are currently no workers awaiting approval.</p>
          </div>

          <hr> <h4><i class="fas fa-user-shield"></i> Service Authorizations for Approved Workers</h4>
          <div class="row" style="margin-top: 10px;">
              <div style="flex: 1; min-width: 280px; margin-right: 20px; max-height: 500px; overflow-y:auto; border: 1px solid var(--bd); padding:15px; border-radius:var(--radius);">
                  <h5><i class="fas fa-users"></i> Approved Support Workers</h5>
                  <ul id="workersListForAuth" class="worker-list-auth" style="list-style-type: none; padding:0;">
                      <li>Loading approved workers...</li>
                  </ul>
              </div>

              <div style="flex: 2; min-width: 450px;">
                  <h5 id="selectedWorkerNameForAuth" style="margin-bottom:15px;"><i class="fas fa-user-check"></i> Select an Approved Worker to Manage Services</h5>
                  <div id="servicesForWorkerContainer" class="hide">
                      <p>Check the services this worker is authorized for:</p>
                      <ul id="servicesListCheckboxes" class="service-list-auth" style="max-height: 400px; overflow-y:auto; border: 1px solid var(--bd); padding:15px; border-radius:var(--radius); background-color: #fff; list-style-type: none;">
                          </ul>
                      <button id="saveWorkerAuthorizationsBtn" class="btn-primary" style="margin-top: 20px;"><i class="fas fa-save"></i> Save Authorizations for Worker</button>
                  </div>
              </div>
          </div>
        </div>

      </section>
    </main>
</div> 

<div id="rqModal" class="modal"><div class="dlg"><h3><i class="fas fa-calendar-check"></i> Request a shift</h3><div class="form-group"><label for="rqDate">Date</label><input type="date" id="rqDate"></div><div class="form-group"><label for="rqStart">Start Time</label><div class="custom-time-picker-container"><input type="text" id="rqStart" class="custom-time-input" readonly placeholder="Select Time" data-value24=""></div></div><div class="form-group"><label for="rqEnd">End Time</label><div class="custom-time-picker-container"><input type="text" id="rqEnd" class="custom-time-input" readonly placeholder="Select Time" data-value24=""></div></div><div class="form-group"><label for="rqReason">Reason (Optional)</label><textarea id="rqReason" rows="3" placeholder="Enter reason..."></textarea></div><div class="modal-actions"><button onclick="saveRequest()" class="btn-primary"><i class="fas fa-paper-plane"></i> Submit</button><button class="btn-secondary" onclick="closeModal('rqModal')"><i class="fas fa-times"></i> Cancel</button></div></div></div>

<div id="logShiftModal" class="modal"><div class="dlg"><h3><i class="fas fa-user-clock"></i> Log New Shift</h3><div class="form-group"><label for="logShiftDate">Date</label><input type="date" id="logShiftDate"></div><div class="form-group"><label for="logShiftSupportType">Support Type</label><select id="logShiftSupportType"></select></div><div class="form-group"><label for="logShiftStartTime">Start Time</label><div class="custom-time-picker-container"><input type="text" id="logShiftStartTime" class="custom-time-input" readonly placeholder="Select Time" data-value24=""></div></div><div class="form-group"><label for="logShiftEndTime">End Time</label><div class="custom-time-picker-container"><input type="text" id="logShiftEndTime" class="custom-time-input" readonly placeholder="Select Time" data-value24=""></div></div><label class="chk"><input type="checkbox" id="logShiftClaimTravelToggle"> Claim Travel?</label><div id="logShiftKmFieldsContainer" class="hide form-subsection"><div class="form-group"><label for="logShiftStartKm">Start Odometer (Km):</label><input type="number" id="logShiftStartKm" placeholder="e.g., 10000.0" step="0.1" min="0"></div><div class="form-group"><label for="logShiftEndKm">End Odometer (Km):</label><input type="number" id="logShiftEndKm" placeholder="e.g., 10020.5" step="0.1" min="0"></div><p style="margin-top: 5px;"><strong>Calculated Travel:</strong> <span id="logShiftCalculatedKm">0.0 Km</span></p></div><div class="modal-actions"><button onclick="saveShiftFromModalToInvoice()" class="btn-primary"><i class="fas fa-file-import"></i> Save to Invoice</button><button class="btn-secondary" onclick="closeModal('logShiftModal')"><i class="fas fa-times"></i> Cancel</button></div></div></div>

<div id="sigModal" class="modal"><div class="dlg"><h3><i class="fas fa-pencil-alt"></i> Draw Signature</h3><canvas id="pad" width="300" height="100"></canvas><br><div class="modal-actions"><button onclick="saveSig()" class="btn-primary"><i class="fas fa-check-circle"></i> Save Signature</button><button class="btn-secondary" onclick="closeModal('sigModal')"><i class="fas fa-times"></i> Cancel</button></div></div></div>

<div id="wiz" class="modal"><div class="dlg"><h3 id="wHead">Setup Progress</h3><div class="wizard-steps"><span id="wizStepIndicator1" class="wizard-step-indicator active">1</span><span id="wizStepIndicator2" class="wizard-step-indicator">2</span><span id="wizStepIndicator3" class="wizard-step-indicator">3</span><span id="wizStepIndicator4" class="wizard-step-indicator">4</span></div><div id="wStep1" class="wizard-step-content"><h4>Step 1: Basic Info</h4><div class="form-group"><label for="wName">Full name</label><input id="wName" type="text"></div><div class="form-group"><label for="wAbn">ABN</label><input id="wAbn" type="text"></div><label class="chk"><input type="checkbox" id="wGst"> GST Registered</label><div class="modal-actions"><button onclick="wizNext()" class="btn-primary">Next <i class="fas fa-arrow-right"></i></button></div></div><div id="wStep2" class="wizard-step-content hide"><h4>Step 2: Bank Details</h4><div class="form-group"><label for="wBsb">BSB</label><input id="wBsb" type="text"></div><div class="form-group"><label for="wAcc">Account number</label><input id="wAcc" type="text"></div><div class="modal-actions"><button class="btn-secondary" onclick="wizPrev()"><i class="fas fa-arrow-left"></i> Previous</button><button onclick="wizNext()" class="btn-primary">Next <i class="fas fa-arrow-right"></i></button></div></div><div id="wStep3" class="wizard-step-content hide"><h4>Step 3: Docs (Optional)</h4><div class="form-group"><label for="wFiles">Upload files</label><input type="file" id="wFiles" multiple></div><div id="wFilesList" class="files-list"></div><div class="modal-actions"><button class="btn-secondary" onclick="wizPrev()"><i class="fas fa-arrow-left"></i> Previous</button><button onclick="wizNext()" class="btn-primary">Next <i class="fas fa-arrow-right"></i></button></div></div><div id="wStep4" class="wizard-step-content hide"><h4>Step 4: All Done!</h4><p>Click Finish.</p><div class="modal-actions"><button class="btn-secondary" onclick="wizPrev()"><i class="fas fa-arrow-left"></i> Previous</button><button onclick="wizFinish()" class="btn-primary"><i class="fas fa-check"></i> Finish</button></div></div></div></div>

<div id="adminSetupWizard" class="modal"><div class="dlg" style="max-width: 650px;"><h3 id="adminWizHead"><i class="fas fa-magic"></i> Portal Setup</h3><div class="wizard-steps"><span id="adminWizStepIndicator1" class="wizard-step-indicator active">1</span><span id="adminWizStepIndicator2" class="wizard-step-indicator">2</span><span id="adminWizStepIndicator3" class="wizard-step-indicator">3</span></div><div id="adminWizStep1" class="wizard-step-content"><h4>Step 1: Portal Type</h4><label class="chk"><input type="radio" name="adminWizPortalType" value="organization" checked> Organization</label><p class="tip">For service providers with multiple workers.</p><label class="chk"><input type="radio" name="adminWizPortalType" value="participant"> Self-Managed Participant</label><p class="tip">For individuals managing their own supports.</p><div class="modal-actions"><button onclick="adminWizNext()" class="btn-primary">Next <i class="fas fa-arrow-right"></i></button></div></div><div id="adminWizStep2" class="wizard-step-content hide"><h4 id="adminWizStep2Title">Step 2: Details</h4><div id="adminWizOrgFields"><div class="form-group"><label for="adminWizOrgName">Org Name:</label><input id="adminWizOrgName" type="text"></div><div class="form-group"><label for="adminWizOrgAbn">Org ABN:</label><input id="adminWizOrgAbn" type="text"></div><div class="form-group"><label for="adminWizOrgContactEmail">Org Email:</label><input id="adminWizOrgContactEmail" type="email"></div><div class="form-group"><label for="adminWizOrgContactPhone">Org Phone:</label><input id="adminWizOrgContactPhone" type="text"></div></div><div id="adminWizUserFields" class="hide"><div class="form-group"><label for="adminWizUserName">Your Name:</label><input id="adminWizUserName" type="text"></div></div><div class="modal-actions"><button class="btn-secondary" onclick="adminWizPrev()"><i class="fas fa-arrow-left"></i> Previous</button><button onclick="adminWizNext()" class="btn-primary">Next <i class="fas fa-arrow-right"></i></button></div></div><div id="adminWizStep3" class="wizard-step-content hide"><h4 id="adminWizStep3Title">Step 3: Participant Details</h4><div class="form-group"><label for="adminWizParticipantName">Participant Name:</label><input id="adminWizParticipantName" type="text"></div><div class="form-group"><label for="adminWizParticipantNdisNo">NDIS No.:</label><input id="adminWizParticipantNdisNo" type="text"></div><div class="form-group"><label for="adminWizPlanManagerName">Plan Manager:</label><input id="adminWizPlanManagerName" type="text"></div><div class="form-group"><label for="adminWizPlanManagerEmail">Plan Manager Email:</label><input id="adminWizPlanManagerEmail" type="email"></div><div class="form-group"><label for="adminWizPlanManagerPhone">Plan Manager Phone:</label><input id="adminWizPlanManagerPhone" type="text"></div><div class="form-group"><label for="adminWizPlanEndDate">Plan End Date:</label><input id="adminWizPlanEndDate" type="date"></div><div class="modal-actions"><button class="btn-secondary" onclick="adminWizPrev()"><i class="fas fa-arrow-left"></i> Previous</button><button onclick="adminWizFinish()" class="btn-primary"><i class="fas fa-check"></i> Finish Setup</button></div></div><div id="adminWizStep4" class="wizard-step-content hide"></div></div></div>

<div id="customTimePicker" class="custom-time-picker-dropdown hide"><div class="time-picker-header">Select Time <span id="currentTimePickerStepLabel"></span></div><div id="timePickerStepAmPm" class="time-picker-step"><label>Period:</label><div id="timePickerAmPmButtons" class="time-options-grid time-options-grid-condensed"></div></div><div id="timePickerStepHour" class="time-picker-step hide"><label>Hour (1-12):</label><div id="timePickerHours" class="time-options-grid"></div></div><div id="timePickerStepMinute" class="time-picker-step hide"><label>Minute:</label><div id="timePickerMinutes" class="time-options-grid time-options-grid-condensed"></div></div><div class="time-picker-actions"><button id="timePickerBackButton" class="btn-secondary btn-small hide"><i class="fas fa-chevron-left"></i> Back</button><button id="setTimeButton" class="btn-primary btn-small" disabled><i class="fas fa-clock"></i> Set Time</button><button id="cancelTimeButton" class="btn-secondary btn-small"><i class="fas fa-times-circle"></i> Cancel</button></div></div>

<div id="messageModal" class="modal"><div class="dlg"><h3 id="messageModalTitle"><i class="fas fa-info-circle"></i> Alert</h3><p id="messageModalText"></p><div class="modal-actions"><button onclick="closeModal('messageModal')" class="btn-primary">OK</button></div></div></div>

<div id="travelCodeSelectionModal" class="modal">
    <div class="dlg">
        <h3><i class="fas fa-map-signs"></i> Select Associated Travel Item Code</h3>
        <p>Choose an existing NDIS service item (must be of 'Travel - Per Kilometre' category) to associate as the travel code for the current service. Ensure the selected travel item has its per-KM rate defined.</p>
        <div class="form-group">
            <label for="travelCodeFilterInput">Filter services:</label>
            <input type="text" id="travelCodeFilterInput" placeholder="Type to filter...">
        </div>
        <div id="travelCodeListContainer" class="modal-list-container"></div>
        <div class="modal-actions">
            <button id="confirmTravelCodeSelectionBtn" class="btn-primary"><i class="fas fa-check-square"></i> Confirm Selection</button>
            <button class="btn-secondary" onclick="closeModal('travelCodeSelectionModal')"><i class="fas fa-times-circle"></i> Cancel</button>
        </div>
    </div>
</div>

<script type="module" src="script.js"></script>

</body>
</html>
